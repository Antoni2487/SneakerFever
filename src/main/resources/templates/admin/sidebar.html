<head xmlns:th="http://www.w3.org/1999/xhtml">
    <meta charset="UTF-8">
    <title>Inventario</title>
    <!-- ✅ PRELOAD para cargar iconos ANTES -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.woff2" as="font" type="font/woff2" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
    <!-- Bootstrap Icons con display=swap para evitar FOIT -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" th:href="@{/admin/css/main.css}">
    
</head>

<div th:fragment="sidebar(activeUri)" xmlns:th="http://www.thymeleaf.org">

    <!-- Botón hamburguesa flotante -->
    <button id="open-sidebar" class="hamburger-floating d-md-none" aria-label="Abrir menú">
        <i class="bi bi-list fs-4"></i>
    </button>

    <!-- Overlay para móviles -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <!-- Sidebar -->
    <nav id="sidebar" class="sidebar d-flex flex-column flex-shrink-0 p-3 text-white">
        <!-- Header -->
        <div class="text-center mb-3 position-relative">
            <a th:href="@{/admin}" class="text-decoration-none d-block">
                <div class="sidebar-brand-container">
                    <div class="sidebar-brand">
                        <img th:src="@{/admin/images/logoX.png}" alt="Logo X" class="sidebar-logo">
                    </div>
                </div>
            </a>
            <button id="close-sidebar" class="btn btn-outline-light btn-sm d-md-none position-absolute"
                    style="top: 0; right: 0;" aria-label="Cerrar menú">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>

        <div class="sidebar-menu-container mb-auto">
            <!-- SECCIÓN: PRINCIPAL -->
            <div class="menu-section">
                <h6 class="sidebar-heading px-3 mt-3 mb-1 text-uppercase">
                    <span>Principal</span>
                </h6>
                <ul class="nav nav-pills flex-column">
                    <li class="nav-item" th:each="opcion : ${session.menuOpciones}"
                        th:if="${#strings.containsIgnoreCase(opcion.nombre, 'dashboard')}">
                        <a th:href="@{${opcion.ruta}}"
                           class="nav-link text-white rounded-3 mb-1 d-flex align-items-center"
                           th:classappend="${opcion.ruta == activeUri or
                                           (opcion.ruta != '/' and #strings.startsWith(activeUri, opcion.ruta + '/'))}
                                           ? 'active' : ''"
                           th:attr="data-route=${opcion.ruta}">
                            <i class="bi bi-speedometer2 me-2"></i>
                            <span th:text="${opcion.nombre}"></span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- SECCIÓN: GESTIÓN DE PRODUCTOS -->
            <div class="menu-section">
                <h6 class="sidebar-heading px-3 mt-3 mb-1 text-uppercase">
                    <span>Productos</span>
                </h6>
                <ul class="nav nav-pills flex-column">
                    <!-- Productos (EXCLUIR categoria, marca, inventario, venta) -->
                    <li class="nav-item" th:each="opcion : ${session.menuOpciones}"
                        th:if="${#strings.containsIgnoreCase(opcion.nombre, 'producto') and 
                                !#strings.containsIgnoreCase(opcion.nombre, 'categoria') and
                                !#strings.containsIgnoreCase(opcion.nombre, 'marca') and
                                !#strings.containsIgnoreCase(opcion.nombre, 'inventario') and
                                !#strings.containsIgnoreCase(opcion.nombre, 'venta')}">
                        <a th:href="@{${opcion.ruta}}"
                           class="nav-link text-white rounded-3 mb-1 d-flex align-items-center"
                           th:classappend="${opcion.ruta == activeUri or
                                           (opcion.ruta != '/' and #strings.startsWith(activeUri, opcion.ruta + '/'))}
                                           ? 'active' : ''"
                           th:attr="data-route=${opcion.ruta}">
                            <i class="bi bi-box-seam me-2"></i>
                            <span th:text="${opcion.nombre}"></span>
                        </a>
                    </li>

                    <!-- Categorías -->
                    <li class="nav-item" th:each="opcion : ${session.menuOpciones}"
                        th:if="${#strings.containsIgnoreCase(opcion.nombre, 'categoria')}">
                        <a th:href="@{${opcion.ruta}}"
                           class="nav-link text-white rounded-3 mb-1 d-flex align-items-center"
                           th:classappend="${opcion.ruta == activeUri or
                                           (opcion.ruta != '/' and #strings.startsWith(activeUri, opcion.ruta + '/'))}
                                           ? 'active' : ''"
                           th:attr="data-route=${opcion.ruta}">
                            <i class="bi bi-grid-3x3-gap-fill me-2"></i>
                            <span th:text="${opcion.nombre}"></span>
                        </a>
                    </li>

                    <!-- Marcas -->
                    <li class="nav-item" th:each="opcion : ${session.menuOpciones}"
                        th:if="${#strings.containsIgnoreCase(opcion.nombre, 'marca')}">
                        <a th:href="@{${opcion.ruta}}"
                           class="nav-link text-white rounded-3 mb-1 d-flex align-items-center"
                           th:classappend="${opcion.ruta == activeUri or
                                           (opcion.ruta != '/' and #strings.startsWith(activeUri, opcion.ruta + '/'))}
                                           ? 'active' : ''"
                           th:attr="data-route=${opcion.ruta}">
                            <i class="bi bi-star-fill me-2"></i>
                            <span th:text="${opcion.nombre}"></span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- SECCIÓN: OPERACIONES -->
            <div class="menu-section">
                <h6 class="sidebar-heading px-3 mt-3 mb-1 text-uppercase">
                    <span>Operaciones</span>
                </h6>
                <ul class="nav nav-pills flex-column">
                    <!-- Ventas (SOLO si contiene "venta" y NO contiene "inventario") -->
                    <li class="nav-item" th:each="opcion : ${session.menuOpciones}"
                        th:if="${#strings.containsIgnoreCase(opcion.nombre, 'venta') and
                                !#strings.containsIgnoreCase(opcion.nombre, 'inventario')}">
                        <a th:href="@{${opcion.ruta}}"
                           class="nav-link text-white rounded-3 mb-1 d-flex align-items-center"
                           th:classappend="${opcion.ruta == activeUri or
                                           (opcion.ruta != '/' and #strings.startsWith(activeUri, opcion.ruta + '/'))}
                                           ? 'active' : ''"
                           th:attr="data-route=${opcion.ruta}">
                            <i class="bi bi-cart-fill me-2"></i>
                            <span th:text="${opcion.nombre}"></span>
                        </a>
                    </li>

                    <!-- Inventario -->
                    <li class="nav-item" th:each="opcion : ${session.menuOpciones}"
                        th:if="${opcion.ruta == '/inventario'}">
                        <a th:href="@{${opcion.ruta}}"
                        class="nav-link text-white rounded-3 mb-1 d-flex align-items-center"
                        th:classappend="${opcion.ruta == activeUri or
                                        (opcion.ruta != '/' and #strings.startsWith(activeUri, opcion.ruta + '/'))}
                                        ? 'active' : ''"
                        th:attr="data-route=${opcion.ruta}">
                            <i class="bi bi-boxes me-2"></i>
                            <span th:text="${opcion.nombre}"></span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- SECCIÓN: ADMINISTRACIÓN -->
            <div class="menu-section">
                <h6 class="sidebar-heading px-3 mt-3 mb-1 text-uppercase">
                    <span>Administración</span>
                </h6>
                <ul class="nav nav-pills flex-column">
                    <!-- Usuarios -->
                    <li class="nav-item" th:each="opcion : ${session.menuOpciones}"
                        th:if="${#strings.containsIgnoreCase(opcion.nombre, 'usuario')}">
                        <a th:href="@{${opcion.ruta}}"
                           class="nav-link text-white rounded-3 mb-1 d-flex align-items-center"
                           th:classappend="${opcion.ruta == activeUri or
                                           (opcion.ruta != '/' and #strings.startsWith(activeUri, opcion.ruta + '/'))}
                                           ? 'active' : ''"
                           th:attr="data-route=${opcion.ruta}">
                            <i class="bi bi-people-fill me-2"></i>
                            <span th:text="${opcion.nombre}"></span>
                        </a>
                    </li>

                    <!-- Perfiles/Roles (CORREGIDO para incluir "perfil") -->
                    <li class="nav-item" th:each="opcion : ${session.menuOpciones}"
                        th:if="${#strings.containsIgnoreCase(opcion.nombre, 'perfil') or 
                                #strings.containsIgnoreCase(opcion.nombre, 'rol') or 
                                #strings.containsIgnoreCase(opcion.nombre, 'permiso')}">
                        <a th:href="@{${opcion.ruta}}"
                           class="nav-link text-white rounded-3 mb-1 d-flex align-items-center"
                           th:classappend="${opcion.ruta == activeUri or
                                           (opcion.ruta != '/' and #strings.startsWith(activeUri, opcion.ruta + '/'))}
                                           ? 'active' : ''"
                           th:attr="data-route=${opcion.ruta}">
                            <i class="bi bi-shield-lock-fill me-2"></i>
                            <span th:text="${opcion.nombre}"></span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- SECCIÓN: CONTACTOS -->
            <div class="menu-section">
                <h6 class="sidebar-heading px-3 mt-3 mb-1 text-uppercase">
                    <span>Contactos</span>
                </h6>
                <ul class="nav nav-pills flex-column">
                    <!-- Clientes -->
                    <li class="nav-item" th:each="opcion : ${session.menuOpciones}"
                        th:if="${#strings.containsIgnoreCase(opcion.nombre, 'cliente')}">
                        <a th:href="@{${opcion.ruta}}"
                           class="nav-link text-white rounded-3 mb-1 d-flex align-items-center"
                           th:classappend="${opcion.ruta == activeUri or
                                           (opcion.ruta != '/' and #strings.startsWith(activeUri, opcion.ruta + '/'))}
                                           ? 'active' : ''"
                           th:attr="data-route=${opcion.ruta}">
                            <i class="bi bi-person-badge-fill me-2"></i>
                            <span th:text="${opcion.nombre}"></span>
                        </a>
                    </li>

                    <!-- Proveedores -->
                    <li class="nav-item" th:each="opcion : ${session.menuOpciones}"
                        th:if="${#strings.containsIgnoreCase(opcion.nombre, 'proveedor')}">
                        <a th:href="@{${opcion.ruta}}"
                           class="nav-link text-white rounded-3 mb-1 d-flex align-items-center"
                           th:classappend="${opcion.ruta == activeUri or
                                           (opcion.ruta != '/' and #strings.startsWith(activeUri, opcion.ruta + '/'))}
                                           ? 'active' : ''"
                           th:attr="data-route=${opcion.ruta}">
                            <i class="bi bi-truck me-2"></i>
                            <span th:text="${opcion.nombre}"></span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- SECCIÓN: REPORTES Y CONFIGURACIÓN -->
            <div class="menu-section">
                <h6 class="sidebar-heading px-3 mt-3 mb-1 text-uppercase">
                    <span>Sistema</span>
                </h6>
                <ul class="nav nav-pills flex-column">
                    <!-- Reportes -->
                    <li class="nav-item" th:each="opcion : ${session.menuOpciones}"
                        th:if="${#strings.containsIgnoreCase(opcion.nombre, 'reporte')}">
                        <a th:href="@{${opcion.ruta}}"
                           class="nav-link text-white rounded-3 mb-1 d-flex align-items-center"
                           th:classappend="${opcion.ruta == activeUri or
                                           (opcion.ruta != '/' and #strings.startsWith(activeUri, opcion.ruta + '/'))}
                                           ? 'active' : ''"
                           th:attr="data-route=${opcion.ruta}">
                            <i class="bi bi-bar-chart-fill me-2"></i>
                            <span th:text="${opcion.nombre}"></span>
                        </a>
                    </li>

                    <!-- Personalización -->
                    <li class="nav-item" th:each="opcion : ${session.menuOpciones}"
                        th:if="${#strings.containsIgnoreCase(opcion.nombre, 'personaliza')}">
                        <a th:href="@{${opcion.ruta}}"
                           class="nav-link text-white rounded-3 mb-1 d-flex align-items-center"
                           th:classappend="${opcion.ruta == activeUri or
                                           (opcion.ruta != '/' and #strings.startsWith(activeUri, opcion.ruta + '/'))}
                                           ? 'active' : ''"
                           th:attr="data-route=${opcion.ruta}">
                            <i class="bi bi-palette-fill me-2"></i>
                            <span th:text="${opcion.nombre}"></span>
                        </a>
                    </li>

                    <!-- Configuración -->
                    <li class="nav-item" th:each="opcion : ${session.menuOpciones}"
                        th:if="${#strings.containsIgnoreCase(opcion.nombre, 'configuracion') or 
                                #strings.containsIgnoreCase(opcion.nombre, 'config')}">
                        <a th:href="@{${opcion.ruta}}"
                           class="nav-link text-white rounded-3 mb-1 d-flex align-items-center"
                           th:classappend="${opcion.ruta == activeUri or
                                           (opcion.ruta != '/' and #strings.startsWith(activeUri, opcion.ruta + '/'))}
                                           ? 'active' : ''"
                           th:attr="data-route=${opcion.ruta}">
                            <i class="bi bi-gear-fill me-2"></i>
                            <span th:text="${opcion.nombre}"></span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <hr>

        <!-- Logout -->
        <ul class="nav nav-pills flex-column">
            <li class="nav-item">
                <a th:href="@{/logout}" class="nav-link logout-link rounded-3 d-flex align-items-center">
                    <i class="bi bi-box-arrow-right me-2"></i>
                    Cerrar Sesión
                </a>
            </li>
        </ul>
    </nav>

    <!-- JavaScript del sidebar -->
     <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script th:src="@{/admin/js/sidebar.js}"></script>
</div>